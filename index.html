<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Boogle ID Reader</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="tesseract.js/tesseract.js"></script>
    <script src="tesseract.js\tesseract.min.js"></script>
</head>
<body>
    <div class="navbar">
        <ul>
            <li><a href="#">Boogle ID Reader</a></li>
            <li><p>HCI 3-р баг</p></li>
        </ul>
    </div>
    <div class="sidebar">
        <ul>
            <h4>Үндсэн</h4>
            <li><a class="active" href="#">Нүүр хуудас</a></li>
            <li><a href="#">OCR гэж юу вэ?</a></li>
            <h4>Холбоосууд</h4>
            <li><a href="#">Хэрхэн ашиглах вэ?</a></li>
            <li><a href="#">Хичээлийн вэбсайт</a></li>
        </ul>
    </div>
    <div class="container">
        <div class="readerBox">
            <div id="log"></div>
            <div id="reader">
                <div class="dragFile">
                    <img src="img/upload.png">
                    <p>Зургийг энэ хэсэгт <b>чирж</b> хуулах боломжтой</p>
                </div>
                <div class="readerFooter">
                    <div class="uploadFile" id="uploadFile">
                        <input type="file" id="real-file" accept="image/*" onchange="recognizeFile(window.lastFile=this.files[0])" hidden/>
                        <span id="upload-text">Хоосон байна</span>
                        <button type="button" id="upload-button">Зураг оруулах</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
            function progressUpdate(packet){
                document.getElementById("reader").style.display = "none";

                var log = document.getElementById('log');
                if(log.firstChild && log.firstChild.status === packet.status){
                    // if('progress' in packet){
                    //     var progress = log.firstChild.querySelector('progress')
                    //     progress.value = packet.progress
                    // }
                }else{
                    var line = document.createElement('div');
                    line.status = packet.status;
                    var status = document.createElement('div')
                    status.className = 'status'
                    status.appendChild(document.createTextNode(packet.status))
                    line.appendChild(status)
                    if('progress' in packet){
                        var progress = document.createElement('progress')
                        progress.value = packet.progress
                        progress.max = 1
                        line.appendChild(progress)
                    }
                    if(packet.status == 'done'){
                        var pre = document.createElement('pre')
                        pre.appendChild(document.createTextNode(packet.data.text))
                        line.innerHTML = ''
                        line.appendChild(pre)
                    }
                    log.insertBefore(line, log.firstChild)
                }
            }
            function recognizeFile(file){
                document.querySelector("#log").innerHTML = ''
              const corePath = window.navigator.userAgent.indexOf("Edge") > -1
                ? 'tesseract.js-core/tesseract-core.asm.js'
                : 'tesseract.js-core/tesseract-core.wasm.js';
              const { TesseractWorker } = Tesseract;
              const worker = new TesseractWorker({
                corePath,
              });
                worker.recognize(file,'mon+eng')
                    .progress(function(packet){
                        console.info(packet)
                        progressUpdate(packet)
                    })
                    .then(function(data){
                        console.log(data)
                        progressUpdate({ status: 'done', data: data })
                    })
            }
            </script>
<script type="text/javascript" src="scripts/scripts.js"></script>
</body>
</html>